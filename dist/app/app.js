function initMagnify(a,b,c){var d=1e3,e=1e3;window.hideMagnifyer=window.hideMagnifyer||!1,$(".large").css("background","url('"+a+"') no-repeat"),$(".polaroid-content").on("touchend",function(a){a.preventDefault(),$(".large").fadeOut(100)}),$(".polaroid-content").on("touchmove mousemove",function(b){if(b.preventDefault(),d||e){var c=$(this).offset(),f=b.originalEvent.touches[0].pageX-c.left,g=b.originalEvent.touches[0].pageY-c.top;if(f<$(this).width()&&g<$(this).height()&&f>0&&g>0?hideMagnifyer||$(".large").fadeIn(100):$(".large").fadeOut(100),$(".large").is(":visible")){var h=-1*Math.round(f/$(".small").width()*d-$(".large").width()/2),i=-1*Math.round(g/$(".small").height()*e-$(".large").height()/2),j=h+"px "+i+"px",k=f-$(".large").width()/2,l=g-$(".large").height()/2-70;$(".large").css({left:k,top:l,backgroundPosition:j})}}else{var m=new Image;m.src=a,d=m.width,e=m.height,console.log(d),console.log(e)}})}function Sketcher(a,b){this.renderFunction=null==b||void 0==b?this.updateCanvasByLine:this.updateCanvasByBrush,this.brush=b,this.touchSupported=Modernizr.touch,this.canvasID=a,this.canvas=$("#"+a),this.context=this.canvas.get(0).getContext("2d"),this.context.strokeStyle="#000000",this.context.lineWidth=3,this.lastMousePoint={x:0,y:0},this.touchSupported?(this.mouseDownEvent="touchstart",this.mouseMoveEvent="touchmove",this.mouseUpEvent="touchend"):(this.mouseDownEvent="mousedown",this.mouseMoveEvent="mousemove",this.mouseUpEvent="mouseup"),this.canvas.bind(this.mouseDownEvent,this.onCanvasMouseDown())}(function(){"use strict";angular.module("cwApp",["ngCookies","ngResource","ngSanitize","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){return b.otherwise("/"),c.html5Mode(!0)}]).run(function(){return FastClick.attach(document.body)})}).call(this),function(){"use strict";angular.module("cwApp").config(["$stateProvider",function(a){return a.state("about",{url:"/about",templateUrl:"app/about/about.html"})}])}.call(this),function(){"use strict";var a,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};angular.module("cwApp").config(["$stateProvider",function(a){return a.state("main",{url:"/:date",templateUrl:"app/main/main.html",controller:"MainCtrl as main",resolve:{photos:["PhotoService",function(a){return a.getImageJSON()}]}})}]),b=function(){function a(a){var b;if(null==a&&(a={}),!angular.isObject(a))throw"'"+(null!=(b=this.constructor)?b.name:void 0)+"' properties must be contructed with an object '{}'";this.filename=a.filename,this.ISOString=a.ISOString,this.timeAgo=a.timeAgo,this.timestamp=a.timestamp}return a}(),a=function(a){function b(a){null==a&&(a={}),b.__super__.constructor.call(this,{filename:"assets/images/empty.png"}),this.type="overlay",this.maxTime=a.maxTime||120,this.heading="Photo is beeing taken",this.description="Can take up to "+this.maxTime/60+" min",this.elapsedTime=0,this.$interval=a.$interval,this.startcounter()}return d(b,a),b.prototype.startcounter=function(){return this.interval=this.$interval(function(a){return function(){return a.elapsedTime<=a.maxTime?a.elapsedTime+=1:a.stopCounter()}}(this),1e3)},b.prototype.stopCounter=function(){return this.$interval.cancel(this.interval)},b}(b),angular.module("cwApp").controller("MainCtrl",["$scope","$stateParams","$log","PhotoService","photos","$interval",function(b,c,d,e,f,g){var h;return new(h=function(){function d(){console.log(f),this.data={photos:angular.copy(f),current:f[0]},this.states={index:0,requestingPhoto:!1,drawing:!1,params:c},this.bindEvents()}return d.prototype.bindEvents=function(){return b.$on("fooCalled",function(a){return console.log(a)}),this.bindWatch(function(){return this.states.index},function(a){return function(b){return a.setCurrentPhoto(b)}}(this)),this.bindWatch(function(){return this.data.photos[0]},function(a){return function(b){return a.setCurrentPhoto(0)}}(this))},d.prototype.bindWatch=function(a,c){return b.$watch(angular.bind(this,a),c)},d.prototype.setCurrentPhoto=function(a){return this.data.current=this.data.photos[a],this.states.index!==a?this.setIndexTo(a):void 0},d.prototype.requestNewPhoto=function(){return this.states.requestingPhoto=!0,e.requestNew().then(function(b){return function(){var c;return c=120,b.data.photos.unshift(new a({$interval:g,maxTime:c})),e.startPolling({maxTime:c})}}(this)).then(function(a){return function(b){return console.log(b),a.data.photos=b,a.states.requestingPhoto=!1}}(this))["catch"](function(a){return function(b){return console.log(b),a.states.requestingPhoto=!1}}(this))},d.prototype.setIndexTo=function(a){return null!=a&&null!=this.data.photos[a]?this.states.index=a:void 0},d.prototype.setIndexToOlder=function(){return this.setIndexTo(this.states.index+1)},d.prototype.setIndexToNewer=function(){return this.setIndexTo(this.states.index-1)},d.prototype.setIndexToLatest=function(){return this.setIndexTo(0)},d.prototype.isLatestShowing=function(){return 0===this.states.index},d.prototype.isOldestShowing=function(){return this.states.index===this.data.photos.length-1},d.prototype.startStopDrawing=function(){var a;return this.states.drawing?(this.data.sketcher.destroy(),window.hideMagnifyer=!1,console.log(window.hideMagnifyer)):(a=new Image,a.src="assets/images/brush2.png",a.onload=function(b){return function(){return b.data.sketcher=new Sketcher("sketch",a)}}(this),window.hideMagnifyer=!0),this.states.drawing=!this.states.drawing},d}())}]),angular.module("cwApp").controller("MainCtrlOriginal",["$scope","$http","$document","$stateParams","$log","$interval","$timeout",function(a,b,c,d,e,f,g){return a.data={imageArray:[]},a.states={},a.currentImg={},a.status={isopen:!1},a.toggled=function(a){return e.log("Dropdown is now: ",a)},console.log(d),FastClick.attach(document.body),a.setIndexTo=function(b){return a.states.index=b},a.setIndexToOlder=function(){return a.states.index!==a.data.imageArray.length-1?a.states.index+=1:void 0},a.setIndexToNewer=function(){return 0!==a.states.index?a.states.index-=1:void 0},a.setIndexToLatest=function(){return console.log("latest"),a.states.index=0},a.$watch("states.index",function(b){return a.currentImg=a.data.imageArray[b]}),a.isLatestShowing=function(){return 0===a.states.index},a.isOldestShowing=function(){return a.states.index===a.data.imageArray.length-1},a.requestPicture=function(){return a.states.requestingNewPhoto=!0,b.post("/api/image/request-new",{}).success(function(c){var d;return a.setIndexToLatest(),a.data.imageArray.splice(0,0,{info:"Photo is beeing taken",filename:"assets/images/empty.png",time:0}),a.currentImg=a.data.imageArray[0],d=f(function(){return 60===a.currentImg.time?f.cancel(d):(a.currentImg.time+=1,b.get("/api/image").success(function(b){return b=b.reverse(),b[0].ISOString!==a.data.imageArray[1].ISOString?(f.cancel(d),console.log("new image!"),a.data.imageArray=b,a.currentImg=a.data.imageArray[0],a.states.requestingNewPhoto=!1):void 0}))},1e3)})},g(function(){return b.get("/api/image").success(function(b){return b=b.reverse(),a.data.imageArray=b,a.items=b,a.setIndexToLatest()})},0)}])}.call(this),function(){"use strict";angular.module("cwApp").directive("imgLoader",function(){return{restrict:"A",link:function(a,b,c,d,e){var f,g,h,i,j,k;return g=0,j=$(b.siblings("div")[1]),f=$(b.siblings("canvas")[0]),h=function(){var a;return b.addClass("loading-img"),j.fadeIn(),a=new Image,setTimeout(function(){return a.src=c.customSrc},g),a.onload=function(){return b[0].src=c.customSrc,k(c.customSrc,b[0].width,b[0].height),j.fadeOut(),b.removeClass("loading-img"),initMagnify(c.customSrc)}},i=function(){var a,c;return c=$(b).width(),a=$(document).height(),$(b).css("height","auto"),$(b).css("height",.73*a)},k=function(a,c,d){var e,g;return g=$(b).width(),e=$(document).height(),$(b).css("height","auto"),$(b).css("height",.73*e),f[0].width=g,f[0].height=$(b).height()},$(window).resize(function(){return i()}),a.$watch(function(){return c.customSrc},function(a,b){return b!==a?h():void 0}),h(c.customSrc)}}})}.call(this),function(){"use strict";angular.module("cwApp").factory("Modal",["$rootScope","$modal",function(a,b){var c;return c=function(c,d){var e;return e=a.$new(),c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})},{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d,e;b=Array.prototype.slice.call(arguments),e=b.shift(),d=void 0,d=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){d.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){d.dismiss(a)}}]}},"modal-danger"),d.result.then(function(c){a.apply(c,b)})}}}}}])}.call(this),function(){"use strict";angular.module("cwApp").controller("NavbarCtrl",["$scope","$location",function(a,b){return a.menu=[{title:"About",link:"/about"}],a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}])}.call(this),function(){"use strict";angular.module("cwApp").factory("PhotoService",["$http","$timeout","$q","$rootScope",function(a,b,c,e){var f,g,h,i,j,k,l;return g=[],j={get:{method:"GET",url:"/api/image",cache:!1},post:{method:"POST",url:"/api/image/request-new"}},l=2e3,i=function(){return h().then(function(){return e.$broadcast("fooCalled","test")})},k=function(a){var c,e,h;return c=g[0],e=0,h=function(){var i;return(e+=1)>=(a||120)/(l/1e3)?(i=new Error("message"),i.http_code=503):f().then(function(a){return c.id===g[0].id?b(h,l):d.resolve(a)})},h(),d.promise},f=function(){return a(j.get).then(function(a){return g=a.data})},h=function(){return a(j.post)},{getImageJSON:f,requestNew:i,startPolling:k}}])}.call(this),Sketcher.prototype.onCanvasMouseDown=function(){var a=this;return function(b){a.mouseMoveHandler=a.onCanvasMouseMove(),a.mouseUpHandler=a.onCanvasMouseUp(),$(document).bind(a.mouseMoveEvent,a.mouseMoveHandler),$(document).bind(a.mouseUpEvent,a.mouseUpHandler),a.updateMousePosition(b),a.renderFunction(b)}},Sketcher.prototype.onCanvasMouseMove=function(){var a=this;return function(b){return a.renderFunction(b),b.preventDefault(),!1}},Sketcher.prototype.onCanvasMouseUp=function(a){var b=this;return function(a){$(document).unbind(b.mouseMoveEvent,b.mouseMoveHandler),$(document).unbind(b.mouseUpEvent,b.mouseUpHandler),b.mouseMoveHandler=null,b.mouseUpHandler=null}},Sketcher.prototype.updateMousePosition=function(a){var b;b=this.touchSupported?a.originalEvent.touches[0]:a;var c=this.canvas.offset();this.lastMousePoint.x=b.pageX-c.left,this.lastMousePoint.y=b.pageY-c.top},Sketcher.prototype.updateCanvasByLine=function(a){this.context.beginPath(),this.context.moveTo(this.lastMousePoint.x,this.lastMousePoint.y),this.updateMousePosition(a),this.context.lineTo(this.lastMousePoint.x,this.lastMousePoint.y),this.context.stroke()},Sketcher.prototype.updateCanvasByBrush=function(a){var b=this.brush.width/2,c=this.brush.height/2,d={x:this.lastMousePoint.x,y:this.lastMousePoint.y};this.updateMousePosition(a);for(var e,f,g={x:this.lastMousePoint.x,y:this.lastMousePoint.y},h=parseInt(Trig.distanceBetween2Points(d,g)),i=Trig.angleBetween2Points(d,g),j=0;h>=j||0==j;j++)e=d.x+Math.sin(i)*j-b,f=d.y+Math.cos(i)*j-c,this.context.drawImage(this.brush,e,f)},Sketcher.prototype.toString=function(){var a=this.canvas.get(0).toDataURL("image/png"),b=a.indexOf(",")+1;return a=a.substring(b)},Sketcher.prototype.toDataURL=function(){var a=this.canvas.get(0).toDataURL("image/png");return a},Sketcher.prototype.clear=function(){var a=this.canvas[0];this.context.clearRect(0,0,a.width,a.height)},Sketcher.prototype.destroy=function(){this.canvas.unbind(this.mouseDownEvent)};var Trig={distanceBetween2Points:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(Math.pow(c,2)+Math.pow(d,2))},angleBetween2Points:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.atan2(c,d)}};angular.module("cwApp").run(["$templateCache",function(a){"use strict";a.put("app/about/about.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class="col-md-6 col-sm-10 col-centered"><br><a href="/" class="back-btn btn btn-default btn-sm"><span><i class="glyphicon glyphicon-chevron-left"></i>Back</span></a><h1>About</h1><p>...</p></div></div></div>'),a.put("app/main/main.html","<div ng-include=&quot;components/navbar/navbar.html&quot;></div><tabset justified=true><div ng-include=&quot;app/main/whiteboard-tab.html&quot; class=whiteboard-tab></div></tabset>"),a.put("app/main/timeline-tab.html",'<br><h4 style="text-align: center">Feature not yet implemented</h4><h5 style="text-align: center"><a href=mailto:simon.johansson@screeninteraction.com>What did you expect to find here?</a></h5>'),a.put("app/main/whiteboard-tab.html",'<div class=container><div class=polaroid><div class="row row-centered"><div class="polaroid-content col-md-6 col-sm-10 col-centered"><img img-loader=img-loader custom-src={{main.data.current.filename}} src=assets/images/empty.png alt="" class="small"><div class=large></div><canvas id=sketch></canvas><div class=loading-overlay><div class=loading><div class="dot dot1"></div><div class="dot dot2"></div><div class="dot dot3"></div><div class="dot dot4"></div></div></div><div ng-include=&quot;components/overlays/info_overlay.html&quot;></div><button role=button ng-click=main.startStopDrawing() ng-class="{ \'btn-success\': main.states.drawing }" class="btn btn-default pencil-icon"><span aria-hidden=true class="glyphicon glyphicon-pencil"></span></button><div class=timestamp-wrapper><h4><span ng-show="main.isLatestShowing() &amp;&amp; main.data.current.type !== \'overlay\'" class=is-latest><span class=text>Latest</span></span> {{main.data.current.timeAgo}}</h4><h4><span class=timestamp>{{main.data.current.timestamp.long}}</span></h4></div></div></div></div><div class=controls><div class="row row-centered"><div class="button-wrapper col-lg-3 col-md-6 col-sm-6 col-centered"><div role=group class="btn-group btn-group-justified"><div dropdown="" is-open=status.isopen class=btn-group><a type=button dropdown-toggle="" class="btn btn-default dropdown-toggle"><span aria-hidden=true class="glyphicon glyphicon-chevron-left"></span><span aria-hidden=true class="glyphicon glyphicon-chevron-left"></span><span class=caret></span></a><ul role=menu class=dropdown-menu><li ng-repeat="file in main.data.photos"><a href=# ng-click=main.setIndexTo($index)>{{file.timeAgo ? file.timeAgo + " - " + file.timestamp.short : "Loading new photo..."}}</a></li></ul></div><a role=button ng-click=main.setIndexToOlder() ng-disabled=main.isOldestShowing() class="btn btn-default"><span aria-hidden=true class="glyphicon glyphicon-chevron-left"></span></a><a role=button ng-click=main.setIndexToNewer() ng-disabled=main.isLatestShowing() class="btn btn-default"><span aria-hidden=true class="glyphicon glyphicon-chevron-right"></span></a><a role=button ng-click=main.setIndexToLatest() ng-disabled=main.isLatestShowing() class="btn btn-default"><b>Latest</b></a><a role=button ng-click=main.requestNewPhoto() ng-disabled=main.states.requestingPhoto class="btn btn-default"><span aria-hidden=true class="glyphicon glyphicon-camera"></span></a></div></div></div></div></div>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class=navbar-xs><div ng-controller=NavbarCtrl class="navbar navbar-inverse navbar-default navbar-static-top"><div class=container><div class=navbar-header><a href="/" class=navbar-brand>Connected Whiteboard</a><ul class="nav navbar-nav pull-right"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li></ul></div></div></div></div>'),a.put("components/overlays/info_overlay.html","<div ng-show=\"main.data.current.type === 'overlay'\" class=info-overlay><h2 class=image-info>{{main.data.current.heading}}</h2><h3>{{main.data.current.description}}</h3><h3><b>{{main.data.current.elapsedTime}} sec</b></h3><h3>Please wait</h3></div>"),a.put("components/overlays/loading_overlay.html",'<div class=loading-overlay><div class=loading><div class="dot dot1"></div><div class="dot dot2"></div><div class="dot dot3"></div><div class="dot dot4"></div></div></div>')}]);